<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Anubhav Calculator</title>

  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#000000">
  <link rel="icon" href="icon-192.svg" sizes="192x192" type="image/svg+xml">

  <style>
    :root{
      --bg:#040405;
      --panel:#0b0c0f;
      --neon: #00e5ff;
      --neon-2:#00bcd4;
      --accent:#00ff80;
      --danger:#ff4d6d;
      --btn:#0f1113;
      --glass: rgba(255,255,255,0.02);
      font-family: Inter, Poppins, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }
    html,body{height:100%;margin:0;background: radial-gradient(circle at 20% 10%, rgba(0,46,55,0.12), transparent 10%), linear-gradient(180deg,#020204 0%, #050507 100%); color:#e6f7ff;}
    .wrap{
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:20px;
    }

    /* Calculator box */
    .calc {
      width:360px;
      max-width:96vw;
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border-radius:22px;
      padding:18px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.8), 0 0 30px rgba(0,230,255,0.04) inset;
      border: 1px solid rgba(0,230,255,0.06);
    }

    .top {
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-bottom:12px;
    }
    .brand {
      font-weight:700;
      color:var(--neon);
      letter-spacing:0.4px;
      font-size:18px;
    }

    .display {
      background: linear-gradient(180deg, rgba(0,0,0,0.35), rgba(255,255,255,0.01));
      border-radius:14px;
      padding:12px 14px;
      min-height:72px;
      box-sizing:border-box;
      color:var(--neon);
      display:flex;
      flex-direction:column;
      justify-content:center;
      border:1px solid rgba(0,230,255,0.06);
      margin-bottom:14px;
      overflow-x:auto;
      gap:6px;
    }
    .display .small {
      font-size:13px;
      color:#98f0ff55;
      height:16px;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .display .big {
      font-size:28px;
      font-weight:700;
      text-align:right;
      color:var(--neon);
      white-space:nowrap;
    }

    .keys {
      display:grid;
      grid-template-columns: repeat(4, 1fr);
      gap:10px;
    }

    button.key {
      height:56px;
      border-radius:12px;
      border: none;
      background:var(--btn);
      color: #dffcff;
      font-weight:700;
      font-size:16px;
      cursor:pointer;
      transition: transform .08s ease, box-shadow .12s ease;
      box-shadow: 0 6px 18px rgba(0,0,0,0.7);
      outline: none;
    }
    button.key:active{ transform: translateY(2px) scale(.995); }

    /* neon border for white-ish keys */
    button.key.number{
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.09));
      border: 1px solid rgba(0,230,255,0.03);
    }
    button.key.operator{
      background:linear-gradient(180deg,var(--neon-2), #008ca5);
      color:#020a0a;
      box-shadow: 0 6px 18px rgba(0,180,200,0.14), 0 0 16px rgba(0,230,255,0.08);
    }
    button.key.equal{
      background: linear-gradient(180deg, var(--accent), #00d252);
      color:#02110a;
      grid-column: span 2;
      box-shadow: 0 8px 28px rgba(0,255,150,0.12), 0 0 24px rgba(0,255,150,0.06);
    }
    button.key.clear{
      background: linear-gradient(180deg, #ff6b7a, #ff3b4f);
      color:#fff;
      box-shadow: 0 6px 18px rgba(255,80,100,0.12);
    }

    /* small neon outlines */
    .neon-outline{
      box-shadow: 0 0 8px rgba(0,230,255,0.06), inset 0 0 12px rgba(0,230,255,0.01);
    }

    /* layout tweaks */
    .row-zero{ display:grid; grid-template-columns: repeat(4, 1fr); gap:10px; margin-bottom:8px; }
    .wide{ grid-column: span 2; }

    .footer { margin-top:10px; text-align:center; color:#73f7ff66; font-size:12px; }

    /* responsive */
    @media (max-width:420px){
      .calc{ width:92vw; padding:14px; }
      button.key{ height:52px; font-size:15px; }
      .display .big{ font-size:22px; }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="calc neon-outline" role="application" aria-label="Anubhav Calculator">
      <div class="top">
        <div class="brand">Anubhav Calculator</div>
        <div style="color:#9ff4ff55;font-weight:600;font-size:13px">PWA • Offline ready</div>
      </div>

      <div class="display" id="display">
        <div class="small" id="expr"></div>
        <div class="big" id="res">0</div>
      </div>

      <div class="keys" id="keys">
        <!-- row 1 -->
        <button class="key operator" data-action="pi">π</button>
        <button class="key operator" data-action="e">e</button>
        <button class="key operator" data-action="sqrt">√</button>
        <button class="key clear" data-action="ac">AC</button>

        <!-- row 2 -->
        <button class="key number" data-action="7">7</button>
        <button class="key number" data-action="8">8</button>
        <button class="key number" data-action="9">9</button>
        <button class="key operator" data-action="/">÷</button>

        <!-- row 3 -->
        <button class="key number" data-action="4">4</button>
        <button class="key number" data-action="5">5</button>
        <button class="key number" data-action="6">6</button>
        <button class="key operator" data-action="*">×</button>

        <!-- row 4 -->
        <button class="key number" data-action="1">1</button>
        <button class="key number" data-action="2">2</button>
        <button class="key number" data-action="3">3</button>
        <button class="key operator" data-action="-">−</button>

        <!-- row 5 -->
        <button class="key number wide" data-action="0">0</button>
        <button class="key number" data-action=".">.</button>
        <button class="key equal" data-action="=">=</button>

        <!-- row 6 -->
        <button class="key operator" data-action="pow">xʸ</button>
        <button class="key operator" data-action="x2">x²</button>
        <button class="key operator" data-action="sin">sin</button>
        <button class="key operator" data-action="cos">cos</button>

        <!-- row 7 -->
        <button class="key operator" data-action="tan">tan</button>
        <button class="key operator" data-action="log">log</button>
        <button class="key operator" data-action="%">%</button>
        <button class="key operator" data-action="back">⌫</button>
      </div>

      <div class="footer">Install: Chrome menu → Add to Home screen</div>
    </div>
  </div>

  <script>
    // Basic PWA-safe calculator logic (client-only)
    const exprEl = document.getElementById('expr');
    const resEl = document.getElementById('res');
    const keys = document.getElementById('keys');

    let expr = '';

    function updateUI(){
      exprEl.textContent = expr;
      // Try to compute a live preview if expression valid
      try {
        const v = safeEval(expr);
        if (v !== undefined && v !== null && Number.isFinite(v)) {
          resEl.textContent = formatNumber(v);
        } else if (!expr) {
          resEl.textContent = '0';
        }
      } catch {
        if (!expr) resEl.textContent = '0';
        else resEl.textContent = 'Error';
      }
    }

    function formatNumber(n){
      if (!isFinite(n)) return 'Error';
      if (Math.abs(n) >= 1e12) return n.toExponential(8);
      if (Math.abs(n) < 1e-10) return '0';
      // round to 10 decimals max
      return Number(Math.round((n + Number.EPSILON) * 1e10)/1e10).toString();
    }

    keys.addEventListener('click', (e)=>{
      const btn = e.target.closest('button');
      if(!btn) return;
      const action = btn.dataset.action;
      switch(action){
        case 'ac': expr=''; break;
        case 'back': expr = expr.slice(0,-1); break;
        case '=': evaluate(); return;
        case 'pi': expr += 'pi'; break;
        case 'e': expr += 'e'; break;
        case 'sqrt': expr += 'sqrt('; break;
        case 'pow': expr += 'pow('; break;
        case 'x2': expr += '**2'; break;
        case 'sin': expr += 'sin('; break;
        case 'cos': expr += 'cos('; break;
        case 'tan': expr += 'tan('; break;
        case 'log': expr += 'log('; break;
        case '%': expr += '%'; break;
        default:
          expr += action || btn.textContent.trim();
      }
      updateUI();
    });

    function evaluate(){
      try {
        const v = safeEval(expr);
        if (!isFinite(v)) { resEl.textContent='Error'; return; }
        resEl.textContent = formatNumber(v);
        expr = String(formatNumber(v));
      } catch {
        resEl.textContent = 'Error';
      }
      updateUI();
    }

    // safe evaluator - maps tokens to Math functions
    function safeEval(s){
      if (!s) return 0;
      // prevent bad tokens
      if (/[A-Za-z]{3,}/.test(s) && !/sqrt|sin|cos|tan|log|pow|pi|e/.test(s)) {
        throw new Error('Invalid token');
      }
      let e = s.replaceAll('×','*').replaceAll('÷','/').replaceAll('−','-').replaceAll('%','/100');
      e = e.replaceAll('pi','Math.PI').replaceAll('e','Math.E');
      e = e.replaceAll('sin','Math.sin').replaceAll('cos','Math.cos').replaceAll('tan','Math.tan');
      e = e.replaceAll('sqrt','Math.sqrt').replaceAll('log','Math.log10').replaceAll('pow','Math.pow');
      // evaluate safely in new Function
      const fn = new Function('return ('+ e +');');
      return fn();
    }

    // keyboard support
    window.addEventListener('keydown', (ev)=>{
      if (ev.key === 'Enter') { ev.preventDefault(); evaluate(); return; }
      if (ev.key === 'Escape') { expr=''; updateUI(); return; }
      if (ev.key === 'Backspace') { expr = expr.slice(0,-1); updateUI(); return; }
      if (/^[0-9]$/.test(ev.key)) { expr += ev.key; updateUI(); return; }
      if (['+','-','*','/','(',')','.'].includes(ev.key)) { expr += ev.key; updateUI(); return; }
      if (ev.key === '%') { expr += '%'; updateUI(); return; }
      // simple shortcuts
      const map = { s: 'sin(', c:'cos(', t:'tan(', l:'log(' };
      if (map[ev.key]) { expr += map[ev.key]; updateUI(); return; }
    });

    // register service worker (if supported)
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('service-worker.js').catch(()=>{ /* ignore */});
    }

    // initial UI
    updateUI();
  </script>
</body>
</html>
